# C++ ν•™μµ λ…ΈνΈ π“

OnVoice COM λΈλ¦¬μ§€ κ°λ° κ³Όμ •μ—μ„ λ°°μ΄ C++ λ° Windows ν”„λ΅κ·Έλλ° λ‚΄μ©μ„ κΈ°λ΅ν•©λ‹λ‹¤.

---

## λ©μ°¨

- [COM κΈ°μ΄](#com-κΈ°μ΄)
- [ν¬μΈν„°μ™€ μ°Έμ΅°](#ν¬μΈν„°μ™€-μ°Έμ΅°)
- [WASAPI μ¤λ””μ¤ μΊ΅μ²](#wasapi-μ¤λ””μ¤-μΊ΅μ²)
- [ATL ν”„λ΅μ νΈ](#atl-ν”„λ΅μ νΈ)
- [λΉλ“ μ‹μ¤ν…](#λΉλ“-μ‹μ¤ν…)

---

## COM κΈ°μ΄

### 2024-11-16: COMμ΄λ€?

**Component Object Model (COM)**: Windowsμ—μ„ ν”„λ΅κ·Έλ¨ κ°„ ν†µμ‹ μ„ μ„ν• ν‘μ¤€ λ°©μ‹

**ν•µμ‹¬ κ°λ… 3κ°€μ§€**:

1. **IUnknown**: λ¨λ“  COM μΈν„°νμ΄μ¤μ λ¶€λ¨ ν΄λμ¤

   - `QueryInterface()`: λ‹¤λ¥Έ μΈν„°νμ΄μ¤ μ”μ²­
   - `AddRef()`: μ°Έμ΅° μΉ΄μ΄νΈ +1
   - `Release()`: μ°Έμ΅° μΉ΄μ΄νΈ -1 (0μ΄ λλ©΄ κ°μ²΄ μ‚­μ )

2. **HRESULT**: COM ν•¨μμ λ°ν™κ°’

   - `S_OK` (0x00000000): μ„±κ³µ
   - `E_FAIL` (0x80004005): μΌλ° μ‹¤ν¨
   - `E_POINTER` (0x80004003): NULL ν¬μΈν„° μ—λ¬

3. **μ°Έμ΅° μΉ΄μ΄ν…**: λ©”λ¨λ¦¬ λ„μ λ°©μ§€λ¥Ό μ„ν• μλ™ λ©”λ¨λ¦¬ κ΄€λ¦¬

```cpp
   IMMDevice* device = NULL;
   enumerator->GetDefaultAudioEndpoint(..., &device);  // AddRef μλ™ νΈμ¶
   // ... device μ‚¬μ© ...
   device->Release();  // μ°Έμ΅° μΉ΄μ΄νΈ -1, 0μ΄ λλ©΄ μλ™ μ‚­μ 
```

**μ™ ν•„μ”ν•κ°€?**

- C++μ—λ” κ°€λΉ„μ§€ μ»¬λ ‰μ…μ΄ μ—†μ–΄μ„ μλ™μΌλ΅ λ©”λ¨λ¦¬ κ΄€λ¦¬ ν•„μ”
- μ—¬λ¬ κ³³μ—μ„ κ°™μ€ κ°μ²΄λ¥Ό μ°Έμ΅°ν•  λ• λ„κ°€ delete ν•΄μ•Ό ν• μ§€ λ¨νΈν•¨
- μ°Έμ΅° μΉ΄μ΄ν…μΌλ΅ "λ§μ§€λ§‰ μ‚¬μ©μκ°€ μλ™μΌλ΅ μ‚­μ "

**λ°°μ΄ μ **:

- β… `CoInitialize()`λ¥Ό ν”„λ΅κ·Έλ¨ μ‹μ‘ μ‹ νΈμ¶ν•μ§€ μ•μΌλ©΄ `E_NOTINITIALIZED` μ—λ¬!
- β… λ¨λ“  COM κ°μ²΄λ” λ°λ“μ‹ `Release()` νΈμ¶ν•΄μ•Ό ν•¨ (λ©”λ¨λ¦¬ λ„μ λ°©μ§€)
- β… HRESULTλ” `SUCCEEDED()`, `FAILED()` λ§¤ν¬λ΅λ΅ μ²΄ν¬

---

## ν¬μΈν„°μ™€ μ°Έμ΅°

### 2024-11-16: ν¬μΈν„° vs μ°Έμ΅°

(ν•™μµ μ§„ν–‰ν•λ©΄μ„ μ¶”κ°€ μμ •)

---

## WASAPI μ¤λ””μ¤ μΊ΅μ²

(Phase 3 μ§„ν–‰ν•λ©΄μ„ μ¶”κ°€ μμ •)

---

## ATL ν”„λ΅μ νΈ

(Phase 7 μ§„ν–‰ν•λ©΄μ„ μ¶”κ°€ μμ •)

---

## λΉλ“ μ‹μ¤ν…

(ν•„μ”ν•  λ• μ¶”κ°€ μμ •)

---

## π”– λΉ λ¥Έ μ°Έμ΅°

### μμ£Ό μ“°λ” HRESULT κ°’

| μ½”λ“          | 16μ§„μ     | μλ―Έ          |
| ------------- | ---------- | ------------- |
| S_OK          | 0x00000000 | μ„±κ³µ          |
| E_FAIL        | 0x80004005 | μΌλ° μ‹¤ν¨     |
| E_POINTER     | 0x80004003 | NULL ν¬μΈν„°   |
| E_NOTIMPL     | 0x80004001 | κµ¬ν„λμ§€ μ•μ |
| E_OUTOFMEMORY | 0x8007000E | λ©”λ¨λ¦¬ λ¶€μ΅±   |

### μμ£Ό μ“°λ” λ§¤ν¬λ΅

```cpp
SUCCEEDED(hr)  // hrμ΄ μ„±κ³µ μ½”λ“μΈμ§€ ν™•μΈ
FAILED(hr)     // hrμ΄ μ‹¤ν¨ μ½”λ“μΈμ§€ ν™•μΈ
```

---

**λ§μ§€λ§‰ μ—…λ°μ΄νΈ**: 2025-11-16
